---
title: "Example Analysis"
format: html
---

**[Question:]{style="color:  #2D4947;"}**
*How has the prevalence of traumatic brain injuries (TBI) changed over time between 2006 and 2014, and how do different mechanisms of injury relate to patient outcomes?*

**[Audience:]{style="color:  #68A39F;"}**
The general public who are interested in learning more about the relatively recent history of TBI trends and outcomes .

**[Data Source:]{style="color:  #68A39F;"}**
This analysis will use data from the Traumatic Brain Injury (TBI) data set posted by the TidyTuesday project from the Data Science Learning Community. This was originally collected to spread awareness about the incidence and causes of brain injury in America. The specific data used in this analysis was sourced from the [CDC](https://www.cdc.gov/traumaticbraininjury/pdf/TBI-Surveillance-Report-FINAL_508.pdf).

::: {.callout-note}
Link to GitHub Repo and data dictionary: [tidytuesday](https://github.com/rfordatascience/tidytuesday/blob/main/data/2020/2020-03-24/readme.md).
:::

```{r}
#| warning: FALSE
# Reading in data of interest
tbi_age <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2020/2020-03-24/tbi_age.csv')
tbi_year <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2020/2020-03-24/tbi_year.csv')
```

**[Analysis]{style="color:  #2D4947;"}**

*Incidence Over Time*

```{r}
#| warning: FALSE
#| message: FALSE

library(dplyr)
library(tidyr)
library(forcats)

# Wrangling data into a separate total rate tibble
all_rate_tbi <- tbi_year %>%
  filter(injury_mechanism == "Total") %>%
  group_by(year, type) %>%
  summarise(estimated_rate = rate_est)

# Wrangling data into a separate total number tibble (injury mehcanism == "Total" does not have a number_est value)
all_number_tbi <- tbi_year %>%
  filter(injury_mechanism != "Total") %>%
  group_by(year, type) %>%
  summarise(estimated_case_num = round(sum(number_est)/1000, digits = 1))

# Joining the two tibbles together
all_tbi <- left_join(all_rate_tbi, all_number_tbi, by = c("year", "type"))

library(ggplot2)
library(ggtext)

# Plotting the incidence of TBI over time
ggplot(all_tbi) +
  geom_point(aes(x = year, y = estimated_rate, color = type), size = 3) +
  geom_line(aes(x = year, y = estimated_rate, color = type), size = 1) +
  scale_color_manual(values = c("Emergency Department Visit" = "#1BB6AFFF", 
                               "Hospitalizations" = "#088BBEFF", 
                               "Deaths" = "#172869FF")) +
  facet_wrap(~factor(type, levels = c("Emergency Department Visit", "Hospitalizations", "Deaths"))) +
  labs(title = "Estimated Rate of Traumatic Brain Injury in the US (2006-2014)",
       subtitle = "insert subtitle here",
       x = "Year",
       y = "Rate per 100,000 in population",
       caption = "insert caption here") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, face = "bold", color = "black", 
                                  hjust = 0.5, margin = margin(b = 10)),
        axis.text.x = element_text(angle = 45, hjust = 1, margin = margin(b = 10)), 
        plot.subtitle = element_textbox_simple(size = 10, hjust = 0.5, margin = margin(b = 12, unit = "pt")),
        legend.position = "none")

ggplot(all_tbi) +
  geom_point(aes(x = year, y = estimated_case_num, color = type), size = 3) +
  geom_line(aes(x = year, y = estimated_case_num, color = type), size = 1) +
  scale_color_manual(values = c("Emergency Department Visit" = "#EA7580FF", 
                                "Hospitalizations" = "#F6A1A5FF", 
                                "Deaths" = "#F8CD9CFF")) +
  facet_wrap(~factor(type, levels = c("Emergency Department Visit", "Hospitalizations", "Deaths"))) +
  labs(title = "Estimated Case Numbers of Traumatic Brain Injury in the US (2006-2014)",
       subtitle = "insert subtitle here",
       x = "Year",
       y = "Number of cases in thousands",
       caption = "insert caption here") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, face = "bold", color = "black", 
                                  hjust = 0.5, margin = margin(b = 10)),
        axis.text.x = element_text(angle = 45, hjust = 1, margin = margin(b = 10)), 
        plot.subtitle = element_textbox_simple(size = 10, hjust = 0.5, margin = margin(b = 12, unit = "pt")),
        legend.position = "none")


```
